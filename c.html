<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Xperts PDF Viewer</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
      color: #333;
    }
    h2 {
      text-align: center;
      padding: 10px;
      background: #007BFF;
      color: white;
      margin: 0;
    }
    #pdf-viewer {
      max-width: 400px;
      margin: 0 auto;
      padding: 10px;
    }
    canvas {
      width: 100% !important;
      height: auto !important;
      margin-bottom: 10px;
      background: white;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .tools {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-bottom: 10px;
    }
    button {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      background: #007BFF;
      color: white;
      font-size: 12px;
    }
    textarea, input {
      width: 100%;
      margin-top: 5px;
      font-size: 14px;
    }
    .section {
      margin: 10px 0;
      padding: 10px;
      background: #fff;
      border-radius: 6px;
    }
    .quiz {
      margin-top: 10px;
    }
    .question {
      font-weight: bold;
    }
    .timer {
      position: fixed;
      top: 0;
      right: 0;
      background: #28a745;
      color: white;
      padding: 5px 10px;
      font-size: 14px;
      border-bottom-left-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="timer" id="studyTimer">‚è±Ô∏è 25:00</div>
  <h2>Xperts - Interactive PDF Viewer</h2>
  <div id="pdf-viewer"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    const viewer = document.getElementById('pdf-viewer');
    const urlParams = new URLSearchParams(window.location.search);
    const pdfUrl = urlParams.get('p');

    const quizzes = {
      1: {
        question: "What is the main topic of page 1?",
        options: ["Math", "Science", "History"],
        answer: "Science"
      },
      2: {
        question: "Who discovered gravity?",
        options: ["Einstein", "Newton", "Tesla"],
        answer: "Newton"
      }
    };

    if (!pdfUrl) {
      viewer.innerHTML = "<p style='color:red;text-align:center;'>Missing PDF URL (?p=...)</p>";
    } else {
      pdfjsLib.getDocument(pdfUrl).promise.then(pdf => {
        for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
          pdf.getPage(pageNum).then(page => {
            const scale = 1.2;
            const viewport = page.getViewport({ scale });
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const section = document.createElement("div");
            section.className = "section";

            const tools = document.createElement("div");
            tools.className = "tools";

            const bookmarkBtn = document.createElement("button");
            bookmarkBtn.textContent = "‚≠ê Bookmark";
            bookmarkBtn.onclick = () => alert(`Bookmarked page ${pageNum}`);

            const notes = document.createElement("textarea");
            notes.placeholder = `üìù Your notes for page ${pageNum}`;
            notes.rows = 3;

            const ttsBtn = document.createElement("button");
            ttsBtn.textContent = "üîä Read Aloud";
            ttsBtn.onclick = () => {
              const msg = new SpeechSynthesisUtterance(`Reading page ${pageNum}`);
              speechSynthesis.speak(msg);
            };

            const completeBtn = document.createElement("button");
            completeBtn.textContent = "‚úÖ Mark as Done";
            completeBtn.onclick = () => alert(`Page ${pageNum} marked as completed`);

            const doubtBtn = document.createElement("button");
            doubtBtn.textContent = "‚ùì Ask Doubt";
            doubtBtn.onclick = () => {
              const doubt = prompt(`Your question about page ${pageNum}:`);
              if (doubt) alert("Submitted!");
            };

            const translateBtn = document.createElement("button");
            translateBtn.textContent = "üåê Translate";
            translateBtn.onclick = () => {
              const link = `https://translate.google.com/translate?sl=auto&tl=hi&u=${encodeURIComponent(pdfUrl)}`;
              window.open(link, "_blank");
            };

            tools.append(bookmarkBtn, ttsBtn, completeBtn, doubtBtn, translateBtn);
            section.append(canvas, tools, notes);

            // Add quiz if available
            if (quizzes[pageNum]) {
              const q = quizzes[pageNum];
              const quizDiv = document.createElement("div");
              quizDiv.className = "quiz";
              quizDiv.innerHTML = `
                <div class="question">üß† ${q.question}</div>
                ${q.options.map(opt => `
                  <label><input type="radio" name="q${pageNum}" value="${opt}"> ${opt}</label><br>
                `).join("")}
              `;
              section.append(quizDiv);
            }

            viewer.appendChild(section);

            page.render({ canvasContext: context, viewport });
          });
        }
      }).catch(err => {
        viewer.innerHTML = `<p style='color:red;'>Error: ${err.message}</p>`;
      });
    }

    // Study Timer
    let seconds = 1500;
    const timerDisplay = document.getElementById("studyTimer");
    setInterval(() => {
      const min = String(Math.floor(seconds / 60)).padStart(2, "0");
      const sec = String(seconds % 60).padStart(2, "0");
      timerDisplay.textContent = `‚è±Ô∏è ${min}:${sec}`;
      if (seconds > 0) seconds--;
    }, 1000);
  </script>
</body>
</html>
