<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join ALLEN</title>
    <style>
        :root {
            --primary-blue: #007bff;
            --light-gray: #f0f2f5;
            --text-dark: #333;
            --text-light: #666;
            --border-color: #ccc;
            --button-bg: #f0f2f5;
            --button-text: #4b4f56;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--light-gray);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: #fff;
            width: 100%;
            max-width: 420px;
            min-height: 600px;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .progress-bar {
            width: 100%;
            height: 4px;
            background-color: #e0e0e0;
            border-radius: 2px;
            margin-bottom: 2rem;
        }
        .progress-bar-inner {
            width: 0%;
            height: 100%;
            background-color: var(--primary-blue);
            border-radius: 2px;
            transition: width 0.4s ease;
        }
        .step {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            flex-grow: 1;
        }
        .step.active {
            display: flex;
        }
        .step-image {
            width: 150px;
            height: 150px;
            background-color: #e9ecef;
            border-radius: 50%;
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #adb5bd;
        }
        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }
        p, label {
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }
        .input-field, .btn-primary {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        .input-field {
            text-align: center;
            margin-bottom: 1rem;
        }
        .btn, .choice-btn {
            background-color: var(--button-bg);
            color: var(--button-text);
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .btn:hover, .choice-btn:hover {
            background-color: #e2e6ea;
            border-color: #bbb;
        }
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            font-weight: 600;
        }
        .choice-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            margin-top: 1rem;
        }
        .choice-grid.single-col { grid-template-columns: 1fr; }
        .choice-grid .choice-btn { padding: 16px; }
        .form-group { width: 100%; margin-bottom: 1rem; text-align: left;}
        .form-group label { margin-bottom: 0.5rem; display: block; }
        .form-group input { width: 100%; text-align: left; padding: 12px; }
        #error-message { color: #d93025; margin-top: 15px; font-size: 0.9rem; height: 20px;}
    </style>
</head>
<body>

    <div class="container">
        <div class="progress-bar">
            <div id="progress-bar-inner" class="progress-bar-inner"></div>
        </div>

        <!-- Step 1: Name -->
        <div id="step-1" class="step active">
            <!-- TODO: Replace with your image -->
            <div class="step-image">üí°</div>
            <h2>We are excited to have you join the ALLEN family!</h2>
            <p>What should we call you?</p>
            <input type="text" id="fullName" class="input-field" placeholder="Student's full name">
            <button class="input-field btn" onclick="nextStep(2)">Next</button>
        </div>

        <!-- Step 2: Goal -->
        <div id="step-2" class="step">
            <div class="step-image">üéØ</div>
            <h2 id="greeting">Hi, [Name]!</h2>
            <p>Please tell us your goal?</p>
            <div class="choice-grid single-col">
                <button class="choice-btn" onclick="selectGoal('NEET')">NEET</button>
                <button class="choice-btn" onclick="selectGoal('JEE')">JEE</button>
                <button class="choice-btn" onclick="selectGoal('Class 6-10')">Class 6-10</button>
            </div>
        </div>

        <!-- Step 3: Class (for 6-10) -->
        <div id="step-3" class="step">
            <div class="step-image">üìö</div>
            <h2>You selected, Class 6-10!</h2>
            <p>Which class are you in?</p>
            <div class="choice-grid">
                <button class="choice-btn" onclick="selectClass('6th')">6th</button>
                <button class="choice-btn" onclick="selectClass('7th')">7th</button>
                <button class="choice-btn" onclick="selectClass('8th')">8th</button>
                <button class="choice-btn" onclick="selectClass('9th')">9th</button>
                <button class="choice-btn" onclick="selectClass('10th')">10th</button>
            </div>
        </div>

        <!-- Step 4: Board (for 6-10) -->
        <div id="step-4" class="step">
             <div class="step-image">üè´</div>
            <h2>Great!</h2>
            <p>Which board are you studying under?</p>
            <div class="choice-grid">
                <button class="choice-btn" onclick="selectBoard('CBSE')">CBSE</button>
                <button class="choice-btn" onclick="selectBoard('ICSE')">ICSE</button>
                <button class="choice-btn" onclick="selectBoard('State Board')">State Board</button>
                <button class="choice-btn" onclick="selectBoard('Others')">Others</button>
            </div>
        </div>
        
        <!-- Step 5: Additional Info -->
        <div id="step-5" class="step">
            <div class="step-image">üë§</div>
            <h2>Just a few more details...</h2>
            <div class="form-group">
                <label for="email">Your Email ID</label>
                <input type="email" id="email" class="input-field" placeholder="student@example.com">
            </div>
            <div class="form-group">
                <label for="mobile">Your Mobile Number</label>
                <input type="tel" id="mobile" class="input-field" placeholder="10-digit mobile number">
            </div>
            <div class="form-group">
                <label for="gender">Gender</label>
                <select id="gender" class="input-field">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Prefer not to say</option>
                </select>
            </div>
            <div class="form-group">
                <label for="parentName">Parent's Name</label>
                <input type="text" id="parentName" class="input-field" placeholder="Parent's full name">
            </div>
             <div class="form-group">
                <label for="parentMobile">Parent's Mobile Number</label>
                <input type="tel" id="parentMobile" class="input-field" placeholder="Parent's mobile number">
            </div>
            <button class="input-field btn" onclick="nextStep(6)">Continue</button>
        </div>

        <!-- Step 6: Password -->
        <div id="step-6" class="step">
            <div class="step-image">üîë</div>
            <h2>Almost done!</h2>
            <p>Create a secure password for your account.</p>
            <input type="password" id="password" class="input-field" placeholder="Create Password (min. 6 characters)">
            <button class="input-field btn" onclick="submitForm()">Create Account</button>
        </div>
        
        <!-- Step 7: Final -->
        <div id="step-7" class="step">
            <div class="step-image">üéâ</div>
            <h2>Thank you for sharing your details!</h2>
            <p>Let's setup your ALLEN experience.</p>
            <button class="input-field btn-primary" onclick="goToLogin()">Let's Go!</button>
        </div>
        
        <p id="error-message"></p>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <script>
        // YOUR FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyBBB2_DHwjdxZpMJYnTSC0BeQKCKP0xlWs",
          authDomain: "xperts-auth.firebaseapp.com",
          projectId: "xperts-auth",
          storageBucket: "xperts-auth.appspot.com",
          messagingSenderId: "143568403446",
          appId: "1:143568403446:web:669a8964aa88aab9b065d7",
          measurementId: "G-082839CKEM"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentStep = 1;
        const totalSteps = 7;
        const formData = {};
        const errorMessage = document.getElementById('error-message');

        function updateProgressBar() {
            const progress = ((currentStep - 1) / (totalSteps -1)) * 100;
            document.getElementById('progress-bar-inner').style.width = `${progress}%`;
        }

        function nextStep(step) {
            errorMessage.textContent = '';
            // Validation for current step before proceeding
            if (currentStep === 1) {
                const name = document.getElementById('fullName').value.trim();
                if (!name) {
                    errorMessage.textContent = "Please enter your name.";
                    return;
                }
                formData.fullName = name;
                document.getElementById('greeting').textContent = `Hi, ${name}!`;
            }
            if (currentStep === 5) {
                 // You can add more detailed validation here
                formData.email = document.getElementById('email').value.trim();
                formData.mobile = document.getElementById('mobile').value.trim();
                formData.gender = document.getElementById('gender').value;
                formData.parentName = document.getElementById('parentName').value.trim();
                formData.parentMobile = document.getElementById('parentMobile').value.trim();
                if (!formData.email || !formData.mobile || !formData.gender || !formData.parentName) {
                    errorMessage.textContent = "Please fill all the required fields.";
                    return;
                }
            }

            document.getElementById(`step-${currentStep}`).classList.remove('active');
            currentStep = step;
            document.getElementById(`step-${currentStep}`).classList.add('active');
            updateProgressBar();
        }

        function selectGoal(goal) {
            formData.goal = goal;
            if (goal === 'Class 6-10') {
                nextStep(3); // Go to Class selection
            } else {
                nextStep(5); // Skip to Additional Info
            }
        }

        function selectClass(className) {
            formData.class = className;
            nextStep(4); // Go to Board selection
        }

        function selectBoard(board) {
            formData.board = board;
            nextStep(5); // Go to Additional Info
        }
        
        async function submitForm() {
            errorMessage.textContent = '';
            formData.password = document.getElementById('password').value;

            if (formData.password.length < 6) {
                errorMessage.textContent = 'Password must be at least 6 characters long.';
                return;
            }
            
            const createButton = document.querySelector('#step-6 button');
            createButton.disabled = true;
            createButton.textContent = 'Creating...';
            
            try {
                // Check if email or mobile already exist
                const emailCheck = await db.collection('users').where('email', '==', formData.email).get();
                if (!emailCheck.empty) throw new Error('This email address is already registered.');
                
                const mobileCheck = await db.collection('users').where('mobile', '==', formData.mobile).get();
                if (!mobileCheck.empty) throw new Error('This mobile number is already registered.');

                // Create user in Auth
                const userCredential = await auth.createUserWithEmailAndPassword(formData.email, formData.password);
                const user = userCredential.user;

                // Store all data in Firestore
                await db.collection('users').doc(user.uid).set({
                    fullName: formData.fullName,
                    email: formData.email,
                    mobile: formData.mobile,
                    goal: formData.goal,
                    class: formData.class || null, // Store as null if not applicable
                    board: formData.board || null, // Store as null if not applicable
                    gender: formData.gender,
                    parentName: formData.parentName,
                    parentMobile: formData.parentMobile,
                    role: 'student', // Default role
                    approved: false,   // Default approval status
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                nextStep(7); // Go to final success step

            } catch (error) {
                console.error("Signup Error:", error);
                errorMessage.textContent = error.message || 'Failed to create account. Please try again.';
                createButton.disabled = false;
                createButton.textContent = 'Create Account';
            }
        }
        
        function goToLogin() {
            window.location.href = 'index.html';
        }

        // Initialize
        updateProgressBar();
    </script>
</body>
</html>
