<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YT Player with Auto Fullscreen Rotate</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .progress-bar::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 14px;
      width: 14px;
      background: white;
      border-radius: 50%;
    }
    .brightness-overlay {
      pointer-events: none;
      background: black;
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      transition: opacity 0.3s ease;
    }
    html, body {
      margin: 0;
      background: black;
      font-family: sans-serif;
    }
  </style>
</head>
<body class="flex justify-center items-start bg-black min-h-screen">

  <div id="container" class="relative w-full max-w-md bg-black" style="height: 370px;">

    <!-- Brightness Overlay -->
    <div id="brightnessOverlay" class="brightness-overlay opacity-0"></div>

    <!-- YouTube Player -->
    <div id="player" class="w-full h-[210px] z-0"></div>

    <!-- Controls -->
    <div class="absolute bottom-0 w-full bg-black/80 p-3 flex flex-col gap-2 z-20">

      <!-- Top Row -->
      <div class="flex items-center gap-3">
        <button id="backBtn">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
               viewBox="0 0 24 24"><path d="M11 19l-7-7 7-7v14zm9 0l-7-7 7-7v14z"/></svg>
        </button>

        <button id="playPauseBtn">
          <svg id="playIcon" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M5 3v18l15-9-15-9z"/>
          </svg>
          <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
            <path d="M6 4h4v16H6zM14 4h4v16h-4z"/>
          </svg>
        </button>

        <button id="forwardBtn">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
               viewBox="0 0 24 24"><path d="M13 5l7 7-7 7V5zM4 5l7 7-7 7V5z"/></svg>
        </button>

        <span id="timeLabel" class="text-xs text-gray-300 ml-auto">0:00 / 0:00</span>
      </div>

      <!-- Progress Bar -->
      <input type="range" id="progressBar" value="0" min="0" max="100"
             class="progress-bar w-full h-2 bg-white/30 rounded"/>

      <!-- Bottom Row -->
      <div class="flex items-center gap-2">
        <label class="text-xs text-white">Speed</label>
        <select id="speedControl" class="bg-gray-800 text-white text-xs rounded px-2 py-0.5">
          <option value="0.5">0.5×</option>
          <option value="1" selected>1×</option>
          <option value="1.5">1.5×</option>
          <option value="2">2×</option>
        </select>

        <label class="text-xs text-white ml-2">Volume</label>
        <input id="volumeControl" type="range" min="0" max="100" value="100"
               class="w-20 h-2 bg-white/30 rounded"/>

        <!-- Fullscreen Toggle -->
        <button id="fullscreenBtn" class="ml-auto">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2"
               viewBox="0 0 24 24">
            <path d="M4 4h6V2H2v8h2V4zm16 0v6h2V2h-8v2h6zm-6 18v-2h6v-6h2v8h-8zm-10-6H2v8h8v-2H4v-6z" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <script>
    let player, isPlaying = false, duration = 0;
    let brightness = 0;

    function getYouTubeID(url) {
      try {
        const u = new URL(url);
        if (u.hostname === 'youtu.be') return u.pathname.slice(1);
        if (u.hostname.includes('youtube.com')) return u.searchParams.get('v');
      } catch {}
      return null;
    }

    function formatTime(s) {
      const m = Math.floor(s / 60);
      return `${m}:${Math.floor(s % 60).toString().padStart(2, '0')}`;
    }

    function onYouTubeIframeAPIReady() {
      const url = new URLSearchParams(location.search).get("url");
      const id = getYouTubeID(url);
      if (!id) return alert("Invalid YouTube URL");

      player = new YT.Player("player", {
        videoId: id,
        playerVars: { controls: 0, modestbranding: 1, rel: 0 },
        events: { onReady: ready, onStateChange: stateChange }
      });
    }

    function ready() {
      duration = player.getDuration();

      document.getElementById("playPauseBtn").onclick = () =>
        isPlaying ? player.pauseVideo() : player.playVideo();

      document.getElementById("backBtn").onclick = () =>
        player.seekTo(player.getCurrentTime() - 10, true);

      document.getElementById("forwardBtn").onclick = () =>
        player.seekTo(player.getCurrentTime() + 10, true);

      document.getElementById("progressBar").oninput = e =>
        player.seekTo((e.target.value / 100) * duration, true);

      document.getElementById("speedControl").onchange = e =>
        player.setPlaybackRate(parseFloat(e.target.value));

      document.getElementById("volumeControl").oninput = e =>
        player.setVolume(parseInt(e.target.value));

      document.getElementById("container").addEventListener("click", e => {
        const x = e.clientX;
        const w = window.innerWidth;
        if (x < w / 2) {
          brightness = Math.min(brightness + 0.1, 0.7);
          document.getElementById("brightnessOverlay").style.opacity = brightness;
        } else {
          const volInput = document.getElementById("volumeControl");
          let newVol = Math.min(parseInt(volInput.value) + 10, 100);
          volInput.value = newVol;
          player.setVolume(newVol);
        }
      });

      // Fullscreen toggle
      const fullscreenBtn = document.getElementById("fullscreenBtn");
      fullscreenBtn.onclick = async () => {
        const container = document.getElementById("container");
        if (!document.fullscreenElement) {
          await container.requestFullscreen();
          if (screen.orientation && screen.orientation.lock) {
            try {
              await screen.orientation.lock("landscape");
            } catch (err) {
              console.warn("Orientation lock failed:", err);
            }
          }
        } else {
          await document.exitFullscreen();
        }
      };

      // Auto-unlock orientation on fullscreen exit
      document.addEventListener("fullscreenchange", () => {
        if (!document.fullscreenElement && screen.orientation?.unlock) {
          screen.orientation.unlock?.();
        }
      });

      updateLoop();
    }

    function stateChange(e) {
      isPlaying = e.data === YT.PlayerState.PLAYING;
      document.getElementById("playIcon").classList.toggle("hidden", isPlaying);
      document.getElementById("pauseIcon").classList.toggle("hidden", !isPlaying);
    }

    function updateLoop() {
      if (player && player.getCurrentTime) {
        const current = player.getCurrentTime();
        duration = player.getDuration();
        document.getElementById("progressBar").value = (current / duration) * 100;
        document.getElementById("timeLabel").textContent = `${formatTime(current)} / ${formatTime(duration)}`;
      }
      requestAnimationFrame(updateLoop);
    }
  </script>
</body>
</html>
