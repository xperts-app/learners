<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Custom YT Player</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      background: black;
    }
    .slider-vertical {
      writing-mode: bt-lr;
      -webkit-appearance: slider-vertical;
      height: 100%;
      width: 40px;
      transform: rotate(180deg);
      pointer-events: auto;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 370px;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
    }
  </style>
</head>
<body class="text-white">

  <div class="w-screen flex flex-col relative overflow-hidden">
    <div class="relative w-full" style="height: 370px;">
      <div id="player" class="w-full h-full"></div>
      <!-- Overlay -->
      <div id="overlay">
        <div class="flex items-center bg-black/30">
          <input type="range" id="brightnessControl" min="0.1" max="2" step="0.1" value="1" class="slider-vertical" />
        </div>
        <div class="flex items-center bg-black/30">
          <input type="range" id="volumeOverlayControl" min="0" max="100" value="100" class="slider-vertical" />
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="bg-gray-900/90 p-3 flex items-center gap-3 text-sm">
      <button id="playPauseBtn">
        ‚ñ∂Ô∏è
      </button>

      <input type="range" id="progressBar" value="0" min="0" max="100" class="w-full" />
      <span id="timeLabel" class="min-w-[80px] text-right text-xs">0:00 / 0:00</span>

      <select id="speedControl" class="bg-gray-800 text-white text-xs rounded px-1">
        <option value="0.5">0.5√ó</option>
        <option value="1" selected>1√ó</option>
        <option value="1.5">1.5√ó</option>
        <option value="2">2√ó</option>
      </select>

      <input id="volumeControl" type="range" min="0" max="100" value="100" class="w-20" />

      <button id="fullscreenBtn" class="ml-auto bg-gray-700 px-2 py-1 rounded text-xs">
        üî≥ Fullscreen
      </button>
    </div>
  </div>

  <script>
    let player;
    let isPlaying = false;
    let duration = 0;

    function getYouTubeID(url) {
      try {
        const parsed = new URL(url);
        if (parsed.hostname === 'youtu.be') return parsed.pathname.slice(1);
        if (parsed.hostname.includes('youtube.com')) return parsed.searchParams.get('v');
      } catch { return null; }
      return null;
    }

    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    function onYouTubeIframeAPIReady() {
      const params = new URLSearchParams(window.location.search);
      const url = params.get("url");
      const videoId = getYouTubeID(url);
      if (!videoId) {
        document.getElementById("player").innerHTML = "<p class='text-white p-4'>Invalid or missing YouTube URL.</p>";
        return;
      }

      player = new YT.Player("player", {
        videoId,
        playerVars: { controls: 0, modestbranding: 1, rel: 0 },
        events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
      });
    }

    function onPlayerReady() {
      duration = player.getDuration();

      document.getElementById("playPauseBtn").onclick = () => {
        isPlaying ? player.pauseVideo() : player.playVideo();
      };

      document.getElementById("progressBar").oninput = (e) => {
        const seek = (e.target.value / 100) * duration;
        player.seekTo(seek, true);
      };

      document.getElementById("speedControl").onchange = (e) => {
        player.setPlaybackRate(parseFloat(e.target.value));
      };

      document.getElementById("volumeControl").oninput = (e) => {
        player.setVolume(parseInt(e.target.value));
        document.getElementById("volumeOverlayControl").value = e.target.value;
      };

      document.getElementById("volumeOverlayControl").oninput = (e) => {
        player.setVolume(parseInt(e.target.value));
        document.getElementById("volumeControl").value = e.target.value;
      };

      document.getElementById("brightnessControl").oninput = (e) => {
        const val = parseFloat(e.target.value);
        document.getElementById("player").style.filter = `brightness(${val})`;
      };

      document.getElementById("fullscreenBtn").onclick = () => {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().then(() => {
            screen.orientation.lock('landscape').catch(() => {});
          });
        } else {
          document.exitFullscreen();
        }
      };

      updateLoop();
    }

    function onPlayerStateChange(e) {
      isPlaying = e.data === YT.PlayerState.PLAYING;
      document.getElementById("playPauseBtn").textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
    }

    function updateLoop() {
      if (player && player.getCurrentTime) {
        const current = player.getCurrentTime();
        duration = player.getDuration();
        const progress = (current / duration) * 100;
        document.getElementById("progressBar").value = progress || 0;
        document.getElementById("timeLabel").textContent = `${formatTime(current)} / ${formatTime(duration)}`;
      }
      requestAnimationFrame(updateLoop);
    }

    window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
  </script>
</body>
</html>
